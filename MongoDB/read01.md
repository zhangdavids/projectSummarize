## MongoDB

它是一款强大、灵活、且易于扩展的通用型数据库，有二级索引、范围查询、排序、聚合、地理空间索引等。  

面向文档的数据库，没有了“行”的概念，取而代之的是文档。通过在文档中嵌套文档和数组，表示层次关系。

没有了*预定义模型（preddfined schema）*，文档的键和值不再是固定的类型和大小。


### 文档

就是键值对的有序集合。  

### 集合  

就是一组文档

集合的命名：

+ 不能是空字符
+ 不能包含\0字符
+ 不能以system.开头
+ 不能在集合名中包含保留字符“$”

多个文档组成集合，多个集合组成数据库

对应

多行组成表，多张表组成数据库

#### 数据类型

+ null

表示空值或者不存在的字段

+ 布尔型

+ 数值  

	NumberInt（4字节带符号整数）  
	NumberLong（8字符带符号整数）  

+ 字符串

+ 日期  

	毫秒数

+ 正则  

	js正则

+ 数组

+ 内嵌文档

+ 对象id

	12字节的id
	
+ 二进制数据

+ 代码	

	任意的 JavaScript 代码
	
#### 传统的 CRUD

+ 插入并且保存

	db.foo.insert({"bar": "baz"})  
	可以使用批量插入  
	插入成功之后会有一个_id自增键
	
	
+ 删除  

	一般使用remove  
	
	清空整个 drop 更快
+ 更新

	db.foo.update()  
	
部分更新的情况  可以使用原子性的更新修改器  

* $set	
* $unset
* $inc
* $push
* $each
* $ne  保证数组元素不重复
* $addToSet 避免重复插入
* $pop


#### 查询（非常重要）

+ find()
+ findOne()

常见的查询条件  

+ $lt 小于
+ $lte 小于等于
+ $gt 大于
+ $gte 大于等于
+ $in 查询一个键的多个值
+ $or 更加通用 可以在多个键中查询任意的给定值
+ $mod 取模
+ $not
+ $and
+ $nor
+ $eq  没有！！！！！！！
+ $in
+ $exists
+ 使用正则可以灵活有效地匹配字符串

+ $all
+ $size 查询特定长度的数组
+ $slice 返回某个键匹配的数组元素的一个子集
+ $where 为了安全起见，应该严格限制或者消除where语句的使用

+ $limit
+ $skip
+ $sort


比较顺序优先级（由小到大）

最小值  
null  
数字  
字符串  
对象／文档  
数组  
二进制数据  
对象ID  
布尔型  
日期型  
时间戳  
正则表达式  
最大值  


### 设计应用

#### 索引

索引永远是绕不去的话题。索引可以用来优化查询。

使用explain（）来查看在执行查询的过程中所做的事情。  

使用ensureIndex（）来创建索引  

复合索引

1. 选择键的方向  

	{"age": 1, "username": -1}
	

2. 覆盖索引

3. 隐式索引



